<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather Dashboard</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass: rgba(255,255,255,0.04)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:linear-gradient(180deg,#071033 0%, #021024 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:980px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    input[type=text]{padding:10px 12px;border-radius:10px;border:0;background:var(--glass);color:inherit;outline:none;width:240px}
    button{background:var(--accent);border:0;padding:10px 12px;border-radius:10px;cursor:pointer;color:#012; font-weight:600}
    .unit-toggle{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:10px;color:var(--muted);cursor:pointer}
    main{display:grid;grid-template-columns:320px 1fr;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,0.5)}
    .current{display:flex;flex-direction:column;gap:12px}
    .location{display:flex;align-items:center;gap:12px}
    .temp{font-size:48px;font-weight:700}
    .desc{color:var(--muted);text-transform:capitalize}
    .meta{display:flex;gap:10px;color:var(--muted);font-size:14px}
    .forecast{display:flex;gap:10px;overflow:auto;padding-bottom:6px}
    .day{min-width:110px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);text-align:center}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
    @media (max-width:840px){main{grid-template-columns:1fr} .temp{font-size:38px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Weather Dashboard</h1>
      <div class="controls">
        <input id="cityInput" type="text" placeholder="Enter city (e.g. London)" />
        <button id="searchBtn">Search</button>
        <button id="geoBtn" class="unit-toggle">Use My Location</button>
        <button id="unitBtn" class="unit-toggle">°C</button>
      </div>
    </header>

    <main>
      <section class="card current" id="currentCard">
        <div class="location">
          <div>
            <div id="city" style="font-weight:700">—</div>
            <div id="country" class="small">—</div>
          </div>
          <div style="margin-left:auto;text-align:right">
            <div id="updated" class="small">—</div>
          </div>
        </div>

        <div style="display:flex;align-items:center;gap:12px">
          <img id="icon" src="" alt="" width="96" height="96" style="display:none" />
          <div>
            <div class="temp" id="temp">—</div>
            <div class="desc" id="desc">—</div>
            <div class="meta" id="meta">
              <div id="feels">—</div>
              <div id="humidity">—</div>
              <div id="wind">—</div>
            </div>
          </div>
        </div>

        <div id="extra" class="small" style="margin-top:8px">—</div>

      </section>

      <section class="card">
        <h3 style="margin:0 0 10px 0">5-point Forecast</h3>
        <div id="forecast" class="forecast">
          <!-- forecast items injected here -->
        </div>
        <footer id="credits">Data provided by OpenWeatherMap</footer>
      </section>
    </main>
  </div>

  <script>
    // ====== CONFIG ======
    // Replace with your OpenWeatherMap API key. Keep this key private in real projects (server-side proxy recommended).
    const API_KEY = 'YOUR_OPENWEATHERMAP_API_KEY';

    // ====== STATE ======
    let unit = 'metric'; // 'metric' for °C, 'imperial' for °F

    // ====== HELPERS ======
    const el = id => document.getElementById(id);
    const q = (s) => document.querySelector(s);

    function formatTime(ts){
      try{
        const d = new Date(ts*1000);
        return d.toLocaleString();
      }catch(e){return '-'}
    }

    function kToC(k){return (k - 273.15).toFixed(1)}

    function toUnit(val){
      // val is temperature in Celsius when using metric; if unit imperial expected, convert
      if(unit === 'metric') return `${Number(val).toFixed(1)} °C`;
      return `${Number(val * 9/5 + 32).toFixed(1)} °F`;
    }

    function showError(msg){
      el('city').textContent = 'Error';
      el('country').textContent = '';
      el('temp').textContent = msg;
      el('desc').textContent = '';
      el('icon').style.display = 'none';
      el('forecast').innerHTML = '';
    }

    // ====== FETCHING ======
    async function fetchCurrentByCity(city){
      const base = 'https://api.openweathermap.org/data/2.5/weather';
      const url = `${base}?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=${unit}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('City not found');
      return res.json();
    }

    async function fetchCurrentByCoords(lat, lon){
      const base = 'https://api.openweathermap.org/data/2.5/weather';
      const url = `${base}?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${unit}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Location weather not available');
      return res.json();
    }

    async function fetchForecastCoords(lat, lon){
      // Use 3-hour forecast and pick 5 next distinct day/time snapshots
      const base = 'https://api.openweathermap.org/data/2.5/forecast';
      const url = `${base}?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${unit}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Forecast not available');
      return res.json();
    }

    // ====== RENDER ======
    function renderCurrent(data){
      el('city').textContent = data.name || '-';
      el('country').textContent = data.sys && data.sys.country ? data.sys.country : '-';
      el('updated').textContent = 'Updated: ' + formatTime(data.dt);

      const tempVal = data.main && data.main.temp != null ? data.main.temp : null;
      el('temp').textContent = tempVal != null ? toUnit(tempVal) : '-';
      el('desc').textContent = data.weather && data.weather[0] ? data.weather[0].description : '-';

      if(data.weather && data.weather[0] && data.weather[0].icon){
        el('icon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
        el('icon').alt = data.weather[0].description || '';
        el('icon').style.display = 'block';
      } else el('icon').style.display = 'none';

      el('feels').textContent = `Feels: ${data.main && data.main.feels_like != null ? toUnit(data.main.feels_like) : '-'}`;
      el('humidity').textContent = `Humidity: ${data.main && data.main.humidity != null ? data.main.humidity + '%' : '-'}`;
      el('wind').textContent = `Wind: ${data.wind && data.wind.speed != null ? data.wind.speed + (unit === 'metric' ? ' m/s' : ' mph') : '-'}`;

      el('extra').textContent = `Coordinates: ${data.coord ? data.coord.lat.toFixed(3) : '-'}, ${data.coord ? data.coord.lon.toFixed(3) : '-'}`;
    }

    function renderForecast(forecast){
      // forecast.list is an array every 3 hours. We'll pick up to 5 entries spaced ~8 indexes (~24h) apart starting from nearest future.
      const list = forecast.list || [];
      if(!list.length){ el('forecast').innerHTML = '<div class="small">No forecast available</div>'; return; }

      const items = [];
      // pick first 5 distinct date entries (by day and roughly midday if possible)
      const picked = {};
      for(const entry of list){
        const d = new Date(entry.dt * 1000);
        const dayKey = d.toDateString();
        if(!picked[dayKey]){
          picked[dayKey] = true;
          items.push(entry);
        }
        if(items.length >= 5) break;
      }

      el('forecast').innerHTML = items.map(it => {
        const d = new Date(it.dt * 1000);
        const day = d.toLocaleDateString(undefined, {weekday:'short', month:'short', day:'numeric'});
        const icon = it.weather && it.weather[0] ? `https://openweathermap.org/img/wn/${it.weather[0].icon}@2x.png` : '';
        const desc = it.weather && it.weather[0] ? it.weather[0].description : '-';
        const t = it.main && it.main.temp != null ? toUnit(it.main.temp) : '-';
        return `
          <div class="day">
            <div class="small">${day}</div>
            ${icon ? `<img src="${icon}" width="64" height="64" alt=""/>` : ''}
            <div style="font-weight:700">${t}</div>
            <div class="small" style="text-transform:capitalize">${desc}</div>
          </div>
        `;
      }).join('');
    }

    // ====== ACTIONS ======
    async function searchCity(){
      const city = el('cityInput').value.trim();
      if(!city) return;
      try{
        const data = await fetchCurrentByCity(city);
        renderCurrent(data);
        const forecast = await fetchForecastCoords(data.coord.lat, data.coord.lon);
        renderForecast(forecast);
      }catch(err){
        console.error(err);
        showError(err.message || 'Failed to fetch');
      }
    }

    async function useGeolocation(){
      if(!navigator.geolocation){ showError('Geolocation unsupported'); return; }
      navigator.geolocation.getCurrentPosition(async pos => {
        try{
          const {latitude, longitude} = pos.coords;
          const data = await fetchCurrentByCoords(latitude, longitude);
          renderCurrent(data);
          const forecast = await fetchForecastCoords(latitude, longitude);
          renderForecast(forecast);
        }catch(err){ console.error(err); showError(err.message || 'Failed to fetch'); }
      }, err => { showError('Permission denied or unavailable'); });
    }

    // ====== EVENTS ======
    el('searchBtn').addEventListener('click', searchCity);
    el('cityInput').addEventListener('keydown', e => { if(e.key === 'Enter') searchCity(); });
    el('geoBtn').addEventListener('click', useGeolocation);
    el('unitBtn').addEventListener('click', () => {
      unit = unit === 'metric' ? 'imperial' : 'metric';
      el('unitBtn').textContent = unit === 'metric' ? '°C' : '°F';
      // re-fetch using current displayed city if possible
      const currentCity = el('city').textContent;
      if(currentCity && currentCity !== 'Error' && currentCity !== '—'){
        el('cityInput').value = currentCity;
        searchCity();
      }
    });

    // ====== INITIAL SAMPLE ======
    // Optional: show a default city on load
    (function init(){
      // If the API key is not replaced, show a helpful placeholder message inside UI (still code only).
      if(API_KEY === 'YOUR_OPENWEATHERMAP_API_KEY'){
        el('city').textContent = 'Add API key';
        el('country').textContent = '';
        el('temp').textContent = 'Replace API_KEY in the code with your OpenWeatherMap API key.';
        el('desc').textContent = '';
        return;
      }

      // Show a default city to demo
      el('cityInput').value = 'New York';
      searchCity();
    })();
  </script>
</body>
</html>
